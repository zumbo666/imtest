name: macOS Test

on:
  workflow_dispatch:

jobs:
  build-macos:
    name: macOS Build
    runs-on: macos-12

    env:
      BASE_DIR: ${{ github.workspace }}/im_build 
      WORKING_DIR: ${{ github.workspace }}

    steps:
    - name: Install dependencies
      run: |
        set -e
        
        export HOMEBREW_NO_AUTO_UPDATE=1
        brew install pkg-config nasm yasm gettext autoconf automake python@3.9

    - name: Build Deps
      run: |
        mkdir ${{ github.workspace }}/deps
        cd ${{ github.workspace }}/deps
        
        wget https://gist.githubusercontent.com/zumbo666/899e916b256e4830e80fce5a1ddb0b4f/raw/2c1270dfd8cba7ef530ba4eff1a22a05fbcb594e/compile_im_deps_intel.sh

        sh compile_im_deps_intel.sh
